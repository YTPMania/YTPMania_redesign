define("discourse/plugins/discourse-whos-online/discourse/api-initializers/intitialize-whos-online-indicators",["exports","discourse-common/utils/decorators","@ember/service","discourse/lib/api"],(function(e,i,t,n){"use strict"
function s(e,i,t,n,s){var r={}
return Object.keys(n).forEach((function(e){r[e]=n[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,i,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r="whos-online"
var o=(0,n.apiInitializer)("0.8",(e=>{var n,o,l,a,u
const c=e.container.lookup("site-settings:main"),d=c.whos_online_avatar_indicator
if("none"!==d&&(c.whos_online_display_public||e.getCurrentUser()?.trust_level>=c.whos_online_display_min_trust_level)){var p,h,b,m
if(document.documentElement.classList.add(`whos-online-${d}`),e.modifyClass("component:user-card-contents",(n=(0,i.default)("user","whosOnline.users.[]"),s(o={pluginId:r,whosOnline:(0,t.inject)(),classNameBindings:["isOnline:user-online"],isOnline(e){return e&&this.whosOnline.isUserOnline(e.id)}},"isOnline",[n],Object.getOwnPropertyDescriptor(o,"isOnline"),o),o)),e.modifyClass("route:user",(l=(0,i.default)("whosOnlineUserId","whosOnline.users.[]"),a=(0,i.observes)("isOnline"),u={pluginId:r,whosOnline:(0,t.inject)(),async afterModel(e){const i=await this._super(...arguments)
return this.set("whosOnlineUserId",e.id),this.updateBodyClass(),i},isOnline(e){return e&&this.whosOnline.isUserOnline(e)},updateBodyClass(){this.isOnline?document.body.classList.add("user-page-online"):document.body.classList.remove("user-page-online")},deactivate(){this._super(),document.body.classList.remove("user-page-online")}},s(u,"isOnline",[l],Object.getOwnPropertyDescriptor(u,"isOnline"),u),s(u,"updateBodyClass",[a],Object.getOwnPropertyDescriptor(u,"updateBodyClass"),u),u)),c.whos_online_avatar_indicator_topic_lists)e.modifyClass("component:topic-list-item",(p=(0,i.default)("topic.lastPoster.id","topic.lastPosterUser.id","whosOnline.users.[]"),s(h={pluginId:r,whosOnline:(0,t.inject)(),classNameBindings:["isOnline:last-poster-online"],isOnline(e,i){return this.whosOnline.isUserOnline(e||i)}},"isOnline",[p],Object.getOwnPropertyDescriptor(h,"isOnline"),h),h)),e.modifyClass("component:latest-topic-list-item",(b=(0,i.default)("topic.lastPoster.id","topic.lastPosterUser.id","whosOnline.users.[]"),s(m={pluginId:r,whosOnline:(0,t.inject)(),classNameBindings:["isOnline:last-poster-online"],isOnline(e,i){return this.whosOnline.isUserOnline(e||i)}},"isOnline",[b],Object.getOwnPropertyDescriptor(m,"isOnline"),m),m))
e.modifyClass("component:scrolling-post-stream",{pluginId:r,didInsertElement(){this._super(),this.appEvents.on("whosonline:changed",this,this._whosOnlineCallback)},willDestroyElement(){this.appEvents.off("whosonline:changed",this,this._whosOnlineCallback)},_whosOnlineCallback(e){e.forEach((e=>{this.attrs.posts.value.filter((i=>{let{user_id:t}=i
return t===e})).map((e=>e.id)).forEach((i=>{this.dirtyKeys.keyDirty(`post-${i}`),this.dirtyKeys.keyDirty(`post-${i}-avatar-${e}`,{onRefresh:"updateOnline"})}))})),this.queueRerender()}}),e.reopenWidget("post-avatar",{buildKey:e=>`post-${e.id}-avatar-${e.user_id}`,isUserOnline(e){return this.register.lookup("service:whos-online").isUserOnline(e)},defaultState(e){return{online:this.isUserOnline(e.user_id)}},updateOnline(){this.state.online=this.isUserOnline(this.attrs.user_id)},buildClasses:(e,i)=>i.online?"user-online":[]})}}))
e.default=o})),define("discourse/plugins/discourse-whos-online/discourse/components/whos-online-avatar",["exports","@ember/component"],(function(e,i){"use strict"
function t(e,i,t){return(i=function(e){var i=function(e,i){if("object"!=typeof e||null===e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,i||"default")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string")
return"symbol"==typeof i?i:String(i)}(i))in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends i.default{constructor(){super(...arguments),t(this,"tagName","a"),t(this,"attributeBindings",["user.username:data-user-card","user.path:href"])}}e.default=n})),define("discourse/plugins/discourse-whos-online/discourse/components/whos-online",["exports","@ember/component","@ember/service","@ember/object","@ember/object/computed"],(function(e,i,t,n,s){"use strict"
var r,o,l,a,u,c,d,p,h
function b(e,i,t,n){t&&Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function m(e,i,t,n,s){var r={}
return Object.keys(n).forEach((function(e){r[e]=n[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,i,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let f=(r=(0,s.readOnly)("whosOnline.count"),o=(0,n.computed)("whosOnline.users.[]"),l=(0,n.computed)("users","users.length"),a=(0,n.computed)("count"),u=(0,n.computed)("count"),c=(0,n.computed)("count"),d=class extends i.default{constructor(){super(...arguments),b(this,"whosOnline",p,this),b(this,"count",h,this)}get users(){return this.whosOnline.users?.slice(0,this.siteSettings.whos_online_maximum_display)}get hasUsers(){return this.users?.length>=this.siteSettings.whos_online_minimum_display}get hasCount(){return this.count>=this.siteSettings.whos_online_minimum_display}get isLong(){return this.count>=this.siteSettings.whos_online_collapse_threshold}get shouldDisplay(){return!(this.count<this.siteSettings.whos_online_minimum_display&&this.siteSettings.whos_online_hide_below_minimum_display)&&this.whosOnline.enabled}},p=m(d.prototype,"whosOnline",[t.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=m(d.prototype,"count",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m(d.prototype,"users",[o],Object.getOwnPropertyDescriptor(d.prototype,"users"),d.prototype),m(d.prototype,"hasUsers",[l],Object.getOwnPropertyDescriptor(d.prototype,"hasUsers"),d.prototype),m(d.prototype,"hasCount",[a],Object.getOwnPropertyDescriptor(d.prototype,"hasCount"),d.prototype),m(d.prototype,"isLong",[u],Object.getOwnPropertyDescriptor(d.prototype,"isLong"),d.prototype),m(d.prototype,"shouldDisplay",[c],Object.getOwnPropertyDescriptor(d.prototype,"shouldDisplay"),d.prototype),d)
e.default=f})),define("discourse/plugins/discourse-whos-online/discourse/services/whos-online",["exports","@ember/service","discourse/models/site","@ember/object","@ember/object/computed"],(function(e,i,t,n,s){"use strict"
var r,o,l,a,u,c,d,p,h
function b(e,i,t,n){t&&Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function m(e,i,t,n,s){var r={}
return Object.keys(n).forEach((function(e){r[e]=n[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=t.slice().reverse().reduce((function(t,n){return n(e,i,t)||t}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,i,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let f=(r=(0,s.readOnly)("channel.users"),o=(0,s.readOnly)("channel.count"),l=(0,s.readOnly)("channel.countOnly"),a=class extends i.default{constructor(){super(...arguments),b(this,"presence",u,this),b(this,"appEvents",c,this),b(this,"users",d,this),b(this,"count",p,this),b(this,"countOnly",h,this)}init(){super.init(...arguments),this.set("channel",this.presence.getChannel("/whos-online/online")),this.enabled&&this.channel.subscribe(t.default.currentProp("whos_online_state")),this.addObserver("users.[]",this,this._usersChanged)}_usersChanged(){const e=new Set(this.users?.map((e=>e.id))||[]),i=this._prevUserIds||new Set([]),t=[...[...e].filter((e=>!i.has(e))),...[...i].filter((i=>!e.has(i)))]
t.length>0&&this.appEvents.trigger("whosonline:changed",t)}get enabled(){return!(!this.currentUser&&this.siteSettings.login_required)&&(this.siteSettings.whos_online_display_public||this.currentUser?.trust_level>=this.siteSettings.whos_online_display_min_trust_level)}isUserOnline(e){return!!this.channel?.users?.findBy("id",e)}},u=m(a.prototype,"presence",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=m(a.prototype,"appEvents",[i.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=m(a.prototype,"users",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=m(a.prototype,"count",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=m(a.prototype,"countOnly",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m(a.prototype,"enabled",[n.computed],Object.getOwnPropertyDescriptor(a.prototype,"enabled"),a.prototype),a)
e.default=f})),define("discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online-avatar",["exports","@ember/template-factory"],(function(e,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=(0,i.createTemplateFactory)({id:"5HJNJtBx",block:'[[[1,[28,[35,0],[[33,1]],[["avatarTemplatePath","title","imageSize"],["avatar_template",[33,1,["username"]],"small"]]]]],[],false,["avatar","user"]]',moduleName:"discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online-avatar.hbs",isStrictMode:!1})
e.default=t})),define("discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online",["exports","@ember/template-factory"],(function(e,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=(0,i.createTemplateFactory)({id:"a3i0o6Z+",block:'[[[41,[33,1],[[[1,"  "],[10,0],[14,1,"whos-online"],[15,0,[52,[33,2],"collapsed"]],[12],[1,"\\n    "],[10,1],[15,"title",[28,[37,3],["whos_online.tooltip"],[["count"],[[33,4,["whos_online_active_timeago"]]]]]],[12],[1,"\\n"],[41,[33,5],[[[1,"        "],[1,[28,[35,3],["whos_online.title"],[["count"],[[33,6]]]]],[1,"\\n"]],[]],[[[41,[33,7],[[[1,"        "],[1,[28,[35,3],["whos_online.count_only"],[["count"],[[33,6]]]]],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[35,3],["whos_online.no_users"],null]],[1,"\\n      "]],[]]]],[]]],[1,"    "],[13],[1,"\\n"],[41,[33,5],[[[42,[28,[37,9],[[28,[37,9],[[33,10]],null]],null],null,[[[1,"        "],[1,[28,[35,11],null,[["user"],[[30,1]]]]],[1,"\\n"]],[1]],null]],[]],null],[1,"  "],[13],[1,"\\n"]],[]],null]],["user"],false,["if","shouldDisplay","isLong","i18n","siteSettings","hasUsers","count","hasCount","each","-track-array","users","whos-online-avatar"]]',moduleName:"discourse/plugins/discourse-whos-online/discourse/templates/components/whos-online.hbs",isStrictMode:!1})
e.default=t})),define("discourse/plugins/discourse-whos-online/discourse/templates/connectors/discovery-list-container-top/online_users_widget",["exports","@ember/template-factory"],(function(e,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var t=(0,i.createTemplateFactory)({id:"NkUzWbOQ",block:'[[[1,[34,0]]],[],false,["whos-online"]]',moduleName:"discourse/plugins/discourse-whos-online/discourse/templates/connectors/discovery-list-container-top/online_users_widget.hbs",isStrictMode:!1})
e.default=t}))

//# sourceMappingURL=discourse-whos-online-d7dde239225684fe1ee9ef2336a204bb49da31a32e20be5bc3935f527d2ad239.map
//!

;
